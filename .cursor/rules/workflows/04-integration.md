# 통합 및 최종 검증 워크플로우 (Phase 3)

> ⚠️ **이 파일을 읽기 전에 먼저 읽어야 할 파일**:
>
> 1. `@00-main-workflow.md` - 전체 프로세스 이해
> 2. `@00-memory.md` - 현재 진행 상황 확인
> 3. Phase 2 (기능별 개발) 완료 여부 확인

## 목표 및 범위

**목표**: 완성된 기능들을 통합하고 전체 시스템의 품질을 보증합니다.

**워크플로우 구조**:

- Step 1: 통합 및 리팩토링
- Step 2: E2E 테스트 및 최종 검증

---

## 사전 요구사항 확인

⚠️ **시작 전 필수 확인**:

1. `@00-memory.md` 읽기 - Phase 2 완료 여부
2. Phase 2 결과물 확인:
   - 모든 기능 구현 완료
   - 모든 기능 테스트 통과
   - 기능별 검수 완료

**Phase 2가 완료되지 않았다면 진행 금지**

---

## API 연동 상태 확인 (Phase 3 시작 전)

### 🔔 API 연동 여부 재확인

"Phase 3 통합 작업을 시작하기 전에 API 연동 상태를 확인하겠습니다."

**현재 API 연동 상태**:

- ✅ **연동 완료**: [기능명1], [기능명2], ...
- ⏳ **Mock API 유지**: [기능명3], [기능명4], ...

**아직 연동되지 않은 API들**:

- [기능명3]: API 준비 상태 확인 필요
- [기능명4]: API 준비 상태 확인 필요

**다음 중 선택해주세요**:

- [ ] **지금 연동하기** (준비된 API만 선별적으로 연동)
- [ ] **나중에 연동하기** (Mock API 유지, Phase 3 진행)
- [ ] **부분 연동하기** (일부만 연동, 나머지는 Mock 유지)

**선택 사항**:

- 연동할 기능: [기능명1], [기능명2], ...
- 연동하지 않을 기능: [기능명3], [기능명4], ...

⚠️ **선택 완료 후 Phase 3 진행**

---

## Step 1: 통합 및 리팩토링

**목표**: 기능 간 중복을 제거하고 전체 코드 구조를 개선합니다.

---

### 1-1. 중복 코드 분석

**AI 작업**:

1. 전체 코드베이스 스캔
2. 중복 패턴 식별

**중복 대상**:

- 유사한 유틸리티 함수
- 반복되는 로직
- 중복된 타입 정의
- 유사한 컴포넌트
- 중복된 API 호출 패턴

**출력 형식**:

```typescript
interface Duplication {
  type: "utility" | "component" | "type" | "hook";
  pattern: string; // '{중복 패턴 설명}'
  locations: string[]; // ['{파일경로1}', '{파일경로2}']
  suggestion: string; // '{통합 제안}'
  impact: "high" | "medium" | "low";
}
```

---

### 1-2. 공통 모듈 추출

**추출 대상**:

1. **공통 유틸리티**

   - 경로: `src/shared/utils/`
   - 📘 예시: formatPrice, formatDate, formatPhoneNumber 등

2. **공통 훅**

   - 경로: `src/shared/hooks/`
   - 📘 예시: usePagination, useDebounce, useLocalStorage 등

3. **공통 타입**

   - 경로: `src/shared/types/common.ts`
   - 📘 예시: PaginationParams, ErrorResponse, ApiResponse<T> 등

4. **공통 상수**
   - 경로: `src/shared/constants/app.ts`
   - 📘 예시: ITEMS_PER_PAGE, API_TIMEOUT, MAX_FILE_SIZE 등

---

### 1-3. 전체 구조 개선

**개선 항목**:

1. **폴더 구조 정리**

   - 일관되지 않은 폴더 구조 통일
   - 파일 위치 재조정
   - 네이밍 규칙 통일

2. **Import 경로 최적화**

   - tsconfig.json에 절대 경로 설정
   - `@/components`, `@/utils` 등 alias 활용

3. **순환 의존성 제거**
   - 공통 모듈로 추출
   - 인터페이스 분리
   - 의존성 역전

---

### 1-4. 성능 최적화 (선택사항)

**최적화 필요 여부**:

- [ ] 성능 최적화 수행
- [ ] 추후 개선으로 보류

**최적화 수행 선택 시**:

#### 🔔 사용자 입력 필요

**성능 목표 설정**:

- 초기 로딩 시간 목표: `_________________`초 (기본값: 3초)
- 페이지 전환 시간 목표: `_________________`초 (기본값: 1초)
- 번들 크기 목표: `_________________`MB (기본값: 1MB)

**최적화 항목** (필요한 것만 선택):

- [ ] React 최적화 (memo, callback, useMemo)
- [ ] 코드 스플리팅
- [ ] 번들 크기 최적화
- [ ] API 호출 최적화
- [ ] 이미지 최적화

**최적화 항목**:

1. **React 최적화**

   - React.memo로 불필요한 리렌더링 방지
   - useCallback, useMemo 활용
   - 컴포넌트 분리

2. **코드 스플리팅**

   - React.lazy로 페이지별 분리
   - Suspense로 로딩 처리
   - 라우트 기반 스플리팅

3. **번들 크기 최적화**

   - 사용하지 않는 코드 제거
   - 무거운 라이브러리 대체
   - Tree shaking 최적화

4. **API 호출 최적화**

   - React Query 캐싱 설정
   - staleTime, cacheTime 조정
   - 불필요한 refetch 방지

5. **이미지 최적화**
   - Lazy loading 적용
   - WebP 포맷 사용
   - 크기 최적화

---

### 1-5. 접근성 개선

**체크리스트**:

- [ ] **키보드 네비게이션**: Tab 순서, 포커스 표시, Enter/Space 동작, ESC 닫기
- [ ] **스크린리더 지원**: alt 텍스트, ARIA 속성, 랜드마크 역할, 폼 레이블
- [ ] **색상 대비**: WCAG AA 기준 충족 (4.5:1)
- [ ] **반응형 접근성**: 터치 타겟 44x44px 이상, 확대 시 레이아웃 유지

---

### 1-6. 통합 테스트 보완

**테스트 항목**:

1. **도메인 간 연동 테스트**

   - 경로: `__tests__/integration/cross-domain/`
   - 📘 예시: 장바구니 → 주문 플로우, 로그인 → 마이페이지 플로우

2. **에러 복구 테스트**

   - 📘 예시: API 실패 후 재시도, 네트워크 에러 처리, 타임아웃 처리

3. **성능 테스트**
   - 초기 로딩 시간 (목표: <3초)
   - 페이지 전환 시간 (목표: <1초)

---

### 1-7. 통합 검수 및 승인

#### 🛑 사용자 검수

"전체 시스템 통합 및 리팩토링이 완료되었습니다."

**작업 결과**:

중복 코드 제거:

- ✅ 공통 유틸리티 N개 추출
- ✅ 공통 훅 N개 추출
- ✅ 공통 타입 N개 통합

구조 개선:

- ✅ Import 경로 최적화 (절대 경로)
- ✅ 순환 의존성 0개
- ✅ 폴더 구조 통일

성능 최적화:

- ✅ 번들 크기 X% 감소
- ✅ 초기 로딩 X.X초 (목표: <3초)
- ✅ 페이지 전환 X.X초 (목표: <1초)

접근성 개선:

- ✅ 키보드 네비게이션 완료
- ✅ ARIA 속성 추가
- ✅ 색상 대비 개선

테스트:

- ✅ 통합 테스트 N개 추가
- ✅ 전체 테스트 통과율 100%
- ✅ 커버리지 X% (목표: 90% 이상)

#### ✅ 검수 항목

- [ ] 코드 구조가 깔끔한가?
- [ ] 성능이 목표치를 충족하는가?
- [ ] 접근성이 개선되었는가?
- [ ] 테스트가 안정적인가?

**승인 여부**:

- [ ] 승인 (E2E 테스트 단계로)
- [ ] 수정 필요 (피드백 제공)

⚠️ **승인 전까지 E2E 테스트 진행 금지**

---

## Step 2: E2E 테스트 및 최종 검증

**목표**: 전체 사용자 플로우를 E2E 테스트로 검증하고 프로덕션 배포를 준비합니다.

---

### 2-1. E2E 테스트 플로우 제안

**AI 작업**: 요구사항 명세서와 구현된 기능을 분석하여 E2E 테스트할 사용자 플로우 제안

**출력 형식**:

```typescript
interface E2EFlow {
  id: string; // 'E2E-XXX'
  name: string; // '{플로우명}'
  priority: "critical" | "high" | "medium" | "low";
  description: string;
  steps: string[]; // ['{단계1}', '{단계2}', ...]
  estimatedTime: string; // '{예상시간}'
  relatedFeatures: string[]; // ['{기능ID1}', '{기능ID2}', ...]
  alternativeScenarios?: string[]; // ['{대체시나리오1}', '{대체시나리오2}']
}
```

#### 🛑 사용자 검수

"다음 E2E 테스트 플로우를 작성하려고 합니다:"

**제안된 플로우 목록 표시** (우선순위별)

"어떤 플로우를 테스트할까요?"

각 플로우별로:

- [ ] 작성 (critical 우선 추천)
- [ ] 수정 (단계 조정)
- [ ] 제외 (불필요)

**선택 사항**:

- 대체 시나리오 포함 여부
- 에러 시나리오 포함 여부

⚠️ **승인된 플로우만 작성**

---

### 2-2. E2E 테스트 작성

승인된 플로우에 대해 E2E 테스트 작성:

**테스트 구조**:

```typescript
// e2e/{flow-name}.spec.ts

test.describe("{플로우명}", () => {
  test("{테스트 케이스명}", async ({ page }) => {
    // {단계별 플로우 설명}
  });

  test("{에러 시나리오명}", async ({ page }) => {
    // {에러 시나리오 검증}
  });
});
```

**포함 사항**:

- 각 단계별 페이지 이동 확인
- 사용자 인터랙션 (클릭, 입력)
- 결과 검증 (URL, 텍스트, 상태)
- 에러 시나리오
- 스크린샷/비디오 캡처 (실패 시)

---

### 2-3. E2E 테스트 실행

**테스트 실행**:

1. 모든 E2E 테스트 실행
2. 실패 시 스크린샷/비디오 확인
3. 에러 로그 분석
4. 재현 단계 문서화

---

### 2-4. 실패 테스트 처리

#### 🔔 사용자 확인

"E2E 테스트 결과:"

- ✅ 통과: N개
- ❌ 실패: N개

**실패한 테스트**:

- E2E-XXX: {테스트명}
  - 실패 단계: {단계명}
  - 에러: {에러 타입}
  - 스크린샷: [첨부]

"다음 중 선택해주세요:"

- [ ] 기능 수정 후 재실행
- [ ] 테스트 코드 수정 필요
- [ ] 환경 문제 (재실행)

---

### 2-5. 최종 품질 검증

#### ✅ 기능 완성도

- [ ] 모든 요구사항 기능 구현
- [ ] 모든 기능 테스트 통과
- [ ] E2E 테스트 통과

#### ✅ 코드 품질

- [ ] 타입 에러 0개
- [ ] Linter 경고 0개
- [ ] 테스트 커버리지 90% 이상
- [ ] 중복 코드 최소화

#### ✅ 성능

- [ ] 초기 로딩 < 3초
- [ ] 페이지 전환 < 1초
- [ ] 번들 크기 목표 달성

#### ✅ 접근성

- [ ] 키보드 네비게이션 가능
- [ ] 스크린리더 호환
- [ ] 색상 대비 WCAG AA 충족

#### ✅ 보안

- [ ] 인증/인가 검증
- [ ] XSS 방어
- [ ] CSRF 방어
- [ ] 민감 정보 보호

#### ✅ 문서화

- [ ] README 업데이트
- [ ] API 문서 작성
- [ ] 배포 가이드 작성

---

### 2-6. 최종 승인

#### 🛑 최종 승인

"프로젝트가 프로덕션 배포 준비가 완료되었습니다."

**최종 상태**:

- ✅ 기능: N개 (100%)
- ✅ 테스트 통과율: 100%
- ✅ E2E 통과: N/N
- ✅ 커버리지: X% (목표: 90% 이상)
- ✅ 성능 목표: 달성
- ✅ 접근성: WCAG AA
- ✅ 문서화: 완료

**배포 준비**:

- 환경 변수 설정 가이드
- 빌드 스크립트
- CI/CD 파이프라인
- 모니터링 설정

**최종 확인**:

- [ ] 승인 (배포 가능)
- [ ] 추가 작업 필요

**승인 시**: 🎉 프로젝트 완료!

---

## Memory 업데이트

**Step별 업데이트**:

Step 1 완료:

- 통합 및 리팩토링 완료 표시
- 공통 모듈 경로 기록
- 성능 지표 기록

Step 2 완료:

- E2E 테스트 결과 기록
- 최종 품질 지표 기록
- Phase 3 완료 표시
- 프로덕션 배포 준비 완료 표시

---

## 결과물

**통합 산출물**:

- `src/shared/utils/` - 공통 유틸리티
- `src/shared/hooks/` - 공통 훅
- `src/shared/types/` - 공통 타입

**테스트**:

- `__tests__/integration/cross-domain/` - 도메인 간 통합 테스트
- `e2e/` - E2E 테스트

**문서**:

- `docs/architecture.md` - 최종 아키텍처
- `docs/deployment.md` - 배포 가이드
- `docs/performance.md` - 성능 최적화 결과
