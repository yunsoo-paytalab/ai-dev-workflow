# 기능 구현 (Phase 2-4)

> ⚠️ **이 파일을 읽기 전에 먼저 읽어야 할 파일**:
>
> 1. `@00-memory.md` - 현재 작업 중인 기능 및 Step 확인
> 2. `@03-2-ui-design.md` - UI 설계 결과 확인
> 3. `@03-3-api-design.md` - API 설계 결과 확인

## 목표 및 범위

**Phase 2-4 목표**: 설계를 바탕으로 테스트를 작성하고, 기능을 구현합니다.

**단계**:

- Step 4: 테스트 작성 (Test-First)
- Step 5: 구현 (Green Phase)
- Step 6: 리팩토링 (Refactor Phase)
- Step 7: 기능 검수 및 승인
- Step 8: 다음 기능으로

---

## 사전 요구사항 확인

⚠️ **시작 전 필수 확인**:

1. `@00-memory.md` 읽기 - 현재 작업 중인 기능 및 Step 확인
2. Phase 2-2, 2-3 완료 확인

**Phase 2-2, 2-3이 완료되지 않았다면 진행 금지**

---

## 현재 Step 확인

**AI 작업**: `@00-memory.md`의 "현재 작업 상태" 섹션에서 다음 확인:

- 현재 작업 중인 기능
- 현재 Step (4, 5, 6, 7, 8 중 하나)
- 진행률

**현재 Step이 Step 4가 아닌 경우**:

- 해당 Step으로 이동 (예: Step 5 → Step 5: 구현 섹션으로)

---

## 테스트 품질 기준

> 📌 **AI 가이드**: 테스트 작성 시 다음 품질 기준을 충족해야 합니다.

### 핵심 품질 기준

**비즈니스 로직**: 핵심 로직 100% 커버 (예외 처리 포함)

- 순수 함수, 유틸리티 함수
- 필터링, 정렬, 계산 로직
- 예외: 없음 (모든 로직 테스트 필수)

**API 서비스**: 성공/실패/에러 케이스 모두 테스트

- API 호출 함수
- 성공/실패 케이스
- 타임아웃, 재시도 로직

**컴포넌트**: 주요 사용자 인터랙션과 상태 변화 테스트

- 렌더링 테스트
- 사용자 인터랙션
- 상태 변화
- 조건부 렌더링

**통합 테스트**: 기능별 핵심 플로우 1-2개

- 기능별 핵심 플로우 1-2개
- 도메인 간 연동 (필요 시)

### 커버리지 목표 (참고용)

**Phase 2 (각 기능마다)**:

- 비즈니스 로직: 90% 이상 권장
- API 서비스: 80% 이상 권장
- 컴포넌트: 70% 이상 권장

**Phase 3 (전체 시스템)**:

- 전체 평균: 85% 이상 권장
- 공통 모듈: 90% 이상 권장

### 품질 미달성 시

**Step 7 (기능 검수)에서**:

- 품질 미달 파일 목록 표시
- 추가 테스트 작성 요청
- 목표 달성 후 승인

**예시**:

```
⚠️ 품질 미달:
- filterProducts.ts: 핵심 로직 미완성 (예외 처리 누락)
- ProductCard.tsx: 주요 인터랙션 테스트 부족

다음 케이스 추가 필요:
- filterProducts: 빈 배열, null 값 처리
- ProductCard: 이미지 로딩 실패, 품절 상태
```

---

## Step 4: 테스트 작성 (Test-First)

### 4-1. 테스트 환경 확인 (최초 1회만)

**AI 작업**: 테스트 도구 설정 여부 확인

- 단위 테스트 도구 설정 완료?
- 컴포넌트 테스트 도구 설정 완료?
- 테스트 헬퍼 유틸리티 생성 완료?

**미완료 시 테스트 환경 설정 먼저 수행** (아래 부록 참조)

---

### 4-2. 테스트 작성 순서

**AI 작업 체크리스트**:

- [ ] 비즈니스 로직 테스트 작성
- [ ] API 서비스 테스트 작성
- [ ] 컴포넌트 테스트 작성
- [ ] 통합 테스트 작성
- [ ] 모든 테스트 실행 및 실패 확인 (Red Phase)

#### 1) 비즈니스 로직 테스트

**작업 내용**: 순수 함수, 유틸리티 함수의 핵심 로직 테스트

**포함 사항**:

- 필터링, 정렬, 계산 로직
- 예외 처리 케이스
- 경계값 테스트

#### 2) API 서비스 테스트

**작업 내용**: API 호출 함수의 성공/실패 케이스 테스트

**포함 사항**:

- 성공 응답 처리
- 에러 응답 처리
- 타임아웃, 재시도 로직

#### 3) 컴포넌트 테스트

**작업 내용**: 컴포넌트의 주요 인터랙션과 상태 변화 테스트

**포함 사항**:

- 렌더링 테스트
- 사용자 인터랙션 (클릭, 입력)
- 상태 변화 확인
- 조건부 렌더링

#### 4) 통합 테스트

**작업 내용**: 기능별 핵심 플로우 테스트

**포함 사항**:

- 전체 페이지 플로우
- 컴포넌트 간 연동
- API와 UI 연동

**테스트 작성 완료 후**:

- [ ] 모든 테스트 실행
- [ ] 테스트 실패 확인 (Red Phase)
- [ ] 실패 이유가 "구현 안됨" 때문인지 확인

### 4-3. Memory 업데이트 (Step 4 완료 시)

**업데이트 시점**: 모든 테스트 작성 완료 후

**업데이트 내용**:

- "현재 작업 상태" → Step: Step 5 (구현), 진행률: 70%
- "테스트 환경 및 현황" → 테스트 파일 경로 기록
- "결과물 파일 경로" → 테스트 파일 경로 추가

---

## Step 5: 구현 (Green Phase)

### AI 작업 체크리스트

- [ ] Step 4 완료 확인 (테스트 작성)
- [ ] 비즈니스 로직 구현 (순수 함수 우선)
- [ ] API 서비스 구현 (타입 안전성 확인)
- [ ] React Query 훅 구현
- [ ] 컴포넌트 로직 구현
- [ ] 페이지 로직 구현
- [ ] 테스트 실행 및 통과 확인 (Green Phase)

### 구현 순서

#### 1) 비즈니스 로직 구현

**작업 내용**: 순수 함수, 유틸리티 함수 구현

**포함 사항**:

- 필터링, 정렬, 계산 로직
- 예외 처리 로직
- 타입 안전성 보장

#### 2) API 서비스 구현

**작업 내용**: API 호출 함수 구현

**포함 사항**:

- HTTP 클라이언트 설정
- 요청/응답 타입 정의
- 에러 처리 로직

#### 3) React Query 훅 구현

**작업 내용**: 데이터 페칭 훅 구현

**포함 사항**:

- 쿼리 키 설정
- 캐싱 전략
- 에러 상태 처리

#### 4) 컴포넌트 로직 구현

**작업 내용**: Phase 2-2에서 작성한 컴포넌트에 로직 추가

**포함 사항**:

- 상태 관리
- 이벤트 핸들러
- 조건부 렌더링

#### 5) 페이지 로직 구현

**작업 내용**: 페이지 컴포넌트의 전체 로직 구현

**포함 사항**:

- 컴포넌트 조합
- 상태 관리
- 라우팅 처리

**구현 완료 후**:

- [ ] 모든 테스트 실행
- [ ] 테스트 통과 확인 (Green Phase)
- [ ] 타입 에러 없음 확인
- [ ] Linter 통과 확인

### 5-1. Memory 업데이트 (Step 5 완료 시)

**업데이트 시점**: 모든 테스트 통과 확인 후

**업데이트 내용**:

- "현재 작업 상태" → Step: Step 6 (리팩토링), 진행률: 85%
- "결과물 파일 경로" → 구현 파일 경로 추가
- "테스트 환경 및 현황" → 테스트 통계 업데이트

---

## Step 6: 리팩토링 (Refactor Phase)

### AI 작업 체크리스트

- [ ] Step 5 완료 확인 (구현)
- [ ] 중복 코드 제거
- [ ] 함수/컴포넌트 분리 (단일 책임)
- [ ] 변수명/함수명 개선
- [ ] 복잡한 로직에 주석 추가
- [ ] 불필요한 코드 제거
- [ ] 커스텀 훅으로 로직 추출 (필요시)
- [ ] 테스트 재실행 및 통과 확인

### 리팩토링 체크리스트

- [ ] 중복 코드 제거
- [ ] 함수/컴포넌트 분리 (단일 책임)
- [ ] 변수명/함수명 개선
- [ ] 복잡한 로직에 주석 추가
- [ ] 불필요한 코드 제거
- [ ] 커스텀 훅으로 로직 추출 (필요시)

**리팩토링 범위**:

- ✅ 현재 기능 범위 내에서만
- ❌ 다른 기능 건드리지 않음
- ❌ 과도한 추상화 지양

**리팩토링 완료 후**:

- [ ] 테스트 재실행 → 여전히 통과
- [ ] 코드 가독성 향상 확인

### 6-1. Memory 업데이트 (Step 6 완료 시)

**업데이트 시점**: 리팩토링 완료 및 테스트 재실행 후

**업데이트 내용**:

- "현재 작업 상태" → Step: Step 7 (기능 검수), 진행률: 95%

---

## Step 7: 기능 검수 및 승인

### AI 작업 체크리스트

- [ ] Step 6 완료 확인 (리팩토링)
- [ ] 구현 결과 요약 작성
- [ ] 사용자 검수 요청
- [ ] 피드백 처리 (수정 필요 시)
- [ ] Memory 업데이트 (승인 후)

### 🛑 사용자 검수

"기능 [F001 - 상품 목록 조회] 구현이 완료되었습니다."

**구현 결과**:

테스트:

- ✅ 작성: 23개
- ✅ 통과: 23/23
- ✅ 커버리지: 94%

구현 파일:

- 비즈니스 로직: `src/features/product/utils/` (2개)
- API 서비스: `src/api/product/` (1개)
- 컴포넌트: `src/pages/`, `src/features/product/components/` (5개)
- 공통 추가: `src/shared/components/Pagination.tsx`

테스트 파일:

- 단위: `__tests__/unit/product/` (2개), `__tests__/unit/api/` (1개)
- 컴포넌트: `__tests__/components/product/` (4개)
- 통합: `__tests__/integration/` (1개)

#### ✅ 검수 항목

- [ ] 기능이 요구사항대로 동작하는가?
- [ ] UI가 디자인대로 구현되었는가?
- [ ] 테스트가 충분한가?
- [ ] 코드 품질이 만족스러운가?
- [ ] 성능이 acceptable한가?
- [ ] 접근성이 고려되었는가?

**승인 여부**:

- [ ] 승인 (다음 기능으로)
- [ ] 수정 필요 (피드백 제공)

⚠️ **승인 전까지 다음 기능 진행 금지**

### 7-1. Memory 업데이트 (Step 7 완료 시)

**업데이트 시점**: 사용자 승인 후

**업데이트 내용**:

- "전체 진행 상황" → 해당 기능 체크 완료
- "기능별 상태" → 해당 기능 완료 표시
- "현재 작업 상태" → 다음 기능 또는 Phase 3 준비

---

## Step 8: 다음 기능으로

### AI 작업 체크리스트

- [ ] Step 7 완료 확인 (기능 검수)
- [ ] 다음 기능 선택 (의존성 고려)
- [ ] Memory 업데이트 (다음 기능으로)
- [ ] 다음 워크플로우 안내

### 다음 기능 선택

**현재 기능 승인 후**:

1. Memory 업데이트 (완료 표시)
2. 다음 기능 선택 (의존성 고려)
3. `@03-1-preparation.md` Step 1부터 반복

**모든 기능 완료 시**:
→ Phase 3로 이동 (`@04-integration.md` 참조)

### 8-1. Memory 업데이트 (Step 8 완료 시)

**업데이트 시점**: 다음 기능 선택 후

**업데이트 내용**:

- "현재 작업 상태" → 다음 기능으로 업데이트
- "다음 단계 안내" → 다음 기능 정보 업데이트

---

## Memory 업데이트 규칙

> 📌 **AI는 다음 시점에 반드시 Memory.md를 업데이트해야 합니다.**

### Step별 업데이트 시점

#### Step 4 완료 시 (테스트 작성)

**업데이트 시점**: 모든 테스트 작성 완료 후
**업데이트 내용**:

- "현재 작업 상태" → Step: Step 5 (구현), 진행률: 70%
- "테스트 환경 및 현황" → 테스트 파일 경로 기록
- "결과물 파일 경로" → 테스트 파일 경로 추가

#### Step 5 완료 시 (구현)

**업데이트 시점**: 모든 테스트 통과 확인 후
**업데이트 내용**:

- "현재 작업 상태" → Step: Step 6 (리팩토링), 진행률: 85%
- "결과물 파일 경로" → 구현 파일 경로 추가
- "테스트 환경 및 현황" → 테스트 통계 업데이트

#### Step 6 완료 시 (리팩토링)

**업데이트 시점**: 리팩토링 완료 및 테스트 재실행 후
**업데이트 내용**:

- "현재 작업 상태" → Step: Step 7 (기능 검수), 진행률: 95%

#### Step 7 완료 시 (기능 검수)

**업데이트 시점**: 사용자 승인 후
**업데이트 내용**:

- "전체 진행 상황" → 해당 기능 체크 완료
- "기능별 상태" → 해당 기능 완료 표시
- "현재 작업 상태" → 다음 기능 또는 Phase 3 준비

#### Step 8 완료 시 (다음 기능으로)

**업데이트 시점**: 다음 기능 선택 후
**업데이트 내용**:

- "현재 작업 상태" → 다음 기능으로 업데이트
- "다음 단계 안내" → 다음 기능 정보 업데이트

### 업데이트 시 주의사항

1. **간결하게 작성**: 각 항목 1-2줄
2. **체크박스 정확히**: `[ ]` → `[x]` 형식 준수
3. **진행률 정확히**: 각 Step별 진행률 반영
4. **파일 경로 기록**: 생성된 파일 경로 정확히 기록

---

## 부록: 테스트 환경 설정 (최초 1회)

### 테스트 도구 선택

#### 🔔 사용자 입력 필요

**질문 1**: 단위 테스트 도구

- [ ] Vitest
- [ ] Jest
- [ ] 기타: `_________________`
- [ ] 없음 (새로 설정)

기존 설정 파일 경로: `_________________`

**질문 2**: 컴포넌트 테스트 라이브러리

- [ ] React Testing Library
- [ ] Enzyme
- [ ] 기타: `_________________`
- [ ] 없음 (새로 설정)

**질문 3**: E2E 테스트 도구

- [ ] Playwright
- [ ] Cypress
- [ ] 기타: `_________________`
- [ ] 없음 (새로 설정)

**질문 4**: 테스트 디렉토리 구조

- [ ] `__tests__/` 폴더 분리
- [ ] 소스 파일과 같은 위치 (`*.test.ts`)
- [ ] 기타: `_________________`

⚠️ **위 정보를 모두 받을 때까지 다음 단계 진행 금지**

### 테스트 환경 구축

**AI 작업**:

1. 선택한 도구 설치 (없는 경우)
2. 설정 파일 생성/확인
3. 테스트 헬퍼 유틸리티 생성
4. 샘플 테스트 작성 및 실행
5. **Memory.md 업데이트** (설정 완료 후)

**결과물**:

- `vitest.config.ts` / `jest.config.js`
- `playwright.config.ts` / `cypress.config.ts`
- `__tests__/setup.ts`
- `__tests__/utils/testHelpers.ts`

**검증**:

- [ ] 샘플 테스트 실행 성공

### 테스트 환경 설정 완료 후 Memory 업데이트

**업데이트 시점**: 테스트 환경 구축 완료 및 검증 성공 후

**업데이트 내용**:

- "테스트 환경 및 현황" 섹션에 다음 정보 기록:
  - **테스트 도구**: 선택된 도구 목록
  - **설정 파일**: 생성된 설정 파일 경로들
  - **테스트 디렉토리**: 테스트 파일 구조
  - **테스트 헬퍼**: 생성된 헬퍼 유틸리티 경로

**예시**:

```
**테스트 도구**: Vitest, React Testing Library, Playwright
**설정 파일**: vitest.config.ts, playwright.config.ts, __tests__/setup.ts
**테스트 디렉토리**: __tests__/ (unit/, components/, integration/)
**테스트 헬퍼**: __tests__/utils/testHelpers.ts
```
