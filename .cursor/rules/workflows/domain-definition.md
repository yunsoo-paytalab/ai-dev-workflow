# 도메인 정의 워크플로우 프롬프트

## Canonical Step Registry (Phase 1 - Domain Definition)

- 1-1: 도메인 모델 정의
- 1-2: 도메인 간 연동 분석 및 정의
- 1-3: 유틸리티 및 설정 인터페이스 정의
- 1-4: 도메인 이벤트 정의

본 레지스트리의 정확한 제목 문자열을 `memory.md` 업데이트 시 그대로 사용합니다.

## 1-1. 도메인 모델 정의

### Context 관리 전략

- **Phase**: Phase 1 (전체 설계)
- **Context 제한**: 전체 도메인 (context 길지만 설계 단계라 괜찮음)
- **필수 참조**: @memory.md, 요구사항 명세서 (memory.md에서 자동 참조)
- **선택적 참조**: 기존 시스템 아키텍처 문서 (memory.md에서 자동 참조)

### AI에게 요청할 내용

```
**⚠️ 중요: 요구사항 명세서 확인 필수**

먼저 다음을 확인하세요:
1. memory.md의 "입력 파일 경로" 섹션에서 요구사항 명세서 경로 확인
2. 해당 파일이 존재하고 내용이 있는지 확인
3. 만약 요구사항 명세서가 없거나 비어있다면, 사용자에게 다음을 요청:

"도메인 정의를 시작하기 위해 요구사항 명세서가 필요합니다.
다음 중 하나의 방법으로 요구사항을 제공해주세요:

1. 📄 요구사항 명세서 파일 첨부 (docs/requirements.md)
2. 📋 기존 시스템 아키텍처 문서 첨부 (docs/architecture.md)
3. 📝 비즈니스 프로세스 문서 첨부 (docs/business-process.md)
4. 💬 채팅에서 직접 요구사항 설명

요구사항이 제공되면 memory.md의 '입력 파일 경로' 섹션을 업데이트하고 도메인 정의를 진행하겠습니다."

요구사항 명세서가 확인되면 다음을 수행하세요:

다음 요구사항을 분석해서 도메인 모델을 식별하고 TypeScript 인터페이스로 정의해주세요:

[요구사항 명세서]

식별 및 정의할 내용:
1. 핵심 비즈니스 엔티티 (TypeScript 인터페이스로)
2. 엔티티 간 관계와 의존성
3. 값 객체 (Value Object) 인터페이스
4. 도메인 서비스 인터페이스
5. 비즈니스 규칙과 제약사항

출력:
- TypeScript 인터페이스 정의 (memory.md의 결과물 경로에 저장)
- 도메인 모델 다이어그램
- JSDoc 문서화
- 비즈니스 규칙 명시

완료 후 memory.md 업데이트:
-
- 현재 단계 완료 체크
- 결과물 파일 경로를 "결과물 파일 경로" 섹션에 동적 추가
- 식별된 도메인 목록을 "도메인별 진행 상황" 섹션에 추가
- Phase 2, 3에 도메인별 작업 항목 동적 생성
- "현재 작업 상태" 섹션 동적 업데이트
- 다음 단계 안내
```

### 체크리스트

- [ ] 모든 핵심 비즈니스 엔티티가 TypeScript 인터페이스로 정의됨
- [ ] 엔티티 간 관계와 의존성이 명확히 정의됨
- [ ] 값 객체(Value Object)가 적절히 식별되고 정의됨
- [ ] 도메인 서비스 인터페이스가 정의됨
- [ ] 비즈니스 규칙이 도메인 모델에 반영됨
- [ ] JSDoc으로 모든 인터페이스가 문서화됨
- [ ] 도메인 모델 다이어그램이 생성됨
- [ ] 타입 안전성이 보장됨

### 결과물

- `src/entities/[domain]/model/` 폴더의 도메인 모델 인터페이스
- `src/entities/[domain]/integration/` 폴더의 도메인 연동 인터페이스
- `src/shared/utils/types/` 폴더의 유틸리티 타입
- `src/config/types/` 폴더의 설정 타입
- `src/entities/[domain]/events/` 폴더의 도메인 이벤트
- 도메인 모델 다이어그램
- 비즈니스 규칙 문서

## 1-2. 도메인 간 연동 분석 및 정의

### Context 관리 전략

- **Phase**: Phase 1 (전체 설계)
- **Context 제한**: 프론트엔드(React) 관점의 도메인 경계에 한정. 서버 계약은 참조만 하고 생성/변경하지 않음
- **필수 참조**: @memory.md, 1-1 단계 결과물
- **선택적 참조**: 라우팅 맵, 화면 플로우, 디자인 시스템 상태 모델, 기존 연동 문서

### AI에게 요청할 내용

```
React 프론트엔드 기준으로, 도메인 모듈 간 연동을 상위 수준에서 분석하고 클라이언트 측 연동 원칙/가이드를 정의해주세요. 이 단계에서는 구체 구현(쿼리/뮤테이션 코드, adapter 구체 로직, 이벤트 버스 구현)을 작성하지 않습니다. 서버측(백엔드) 연동 인터페이스나 도메인 서비스 인터페이스는 생성하지 않습니다.

[입력]
- 도메인 모델(1-1 결과물)
- 화면 플로우/라우팅 맵
- 캐시 정책/만료 요구사항(있다면)

[분석할 내용(상위 수준)]
1. 프론트 도메인 모듈 간 의존성 관계(`src/features/[domain]` 경계 기준)
2. 데이터/상태 흐름(컴포넌트 상태 ↔ React Query 캐시 ↔ URL/라우팅 ↔ 로컬 스토리지 등)
3. 쿼리/뮤테이션 경계와 캐시 무결성 전략(무효화/리패치/옵티미스틱 업데이트)
4. 에러 전파 경로와 UX 정책(토스트/바운더리/재시도)
5. 권한/세션/피처 플래그가 상태 흐름에 미치는 영향
6. 도메인 간 이벤트 연동(경량 pub/sub 또는 전역 이벤트 바운더리 필요 시)
7. URL 파라미터/검색어/히스토리에 상태를 투영해야 하는 지점

[정의할 내용(가이드)]
1. 클라이언트 연동 규칙과 모듈 간 의존성 가이드(금지/허용 경로 명시)
2. React Query 키 네이밍 규칙과 무효화 매트릭스의 원칙(예시 포함, 구현은 Phase 2)
3. API DTO 검증 스키마와 adapter의 원칙/시그니처 가이드(구현은 Phase 2)
4. 공통 selector/파생 상태 함수의 책임 경계와 시그니처 가이드
5. 경량 이벤트 버스가 필요한 조건과 이벤트 타입 명명 규칙(필요 시, 구현은 Phase 2/3)
6. 표준 에러 타입 분류, 재시도/폴백 정책, 사용자 피드백 규칙(구현은 Phase 2)

[후속 단계 위임]
- Phase 2: 각 도메인별 연동 구현(queries/mutations, adapters, selectors, 에러 핸들러)
- Phase 3: 교차 도메인 이벤트/고급 캐싱/성능 최적화 및 테스트 전략 확정

[명시적 제외]
- 서버 연동 인터페이스/도메인 서비스 정의를 프론트에서 생성하지 않습니다.
- 백엔드 도메인 모델을 프론트에서 중복 정의하지 않습니다(필요 시 DTO 스키마만 정의).

[출력]
- 프론트 도메인 간 연동 다이어그램(클라이언트 관점)
- 상태/데이터 흐름도, 의존성 그래프
- DTO 스키마 및 adapter 시그니처 정의(파일 경로 포함)

완료 후 memory.md 업데이트:
- 현재 단계 완료 체크
- 결과물 파일 경로 기록
- 다음 단계 안내
```

### 체크리스트

- [ ] 클라이언트 모듈 간 의존성이 식별되고 순환 의존성이 없음(상위 수준 다이어그램)
- [ ] 상태/데이터 흐름이 상위 수준으로 합의됨(컴포넌트/쿼리/라우팅/스토리지 역할 구분)
- [ ] React Query 키 규칙/무효화 전략의 원칙이 합의됨(구현은 Phase 2)
- [ ] DTO 검증/adapter 원칙이 합의됨(서버 계약과 동기화, 구현은 Phase 2)
- [ ] 에러 전파/UX 정책의 원칙이 합의됨(재시도/폴백 포함)
- [ ] 이벤트 버스 필요 조건과 타입 명명 규칙이 합의됨(필요 시)
- [ ] "서버 연동 인터페이스 생성 금지" 원칙이 문서에 명시됨
- [ ] import 규칙/모듈 경계 가드가 제안됨(eslint-import, tsconfig path 등)
- [ ] 상세 구현은 Phase 2/3로 위임됨이 문서화됨

#### 구축하지 않는 경우(명시)

- 단순 REST 호출로 컴포넌트 내부에서만 소비되는 데이터
- 1회성 화면 상태로 글로벌 캐시/공유가 불필요
- 서버 계약 변경 가능성이 낮고 재사용 요구가 없음
- 라이프사이클이 컴포넌트에 국한되어 도메인 간 연계가 없을 때

#### 구축이 필요한 경우(예외)

- 동일 데이터가 여러 도메인/페이지에서 재사용됨
- 서버 계약이 불안정하거나 다중 소스 결합/정규화가 필요함
- 마이크로프론트엔드/패키지로 재사용되는 SDK 형태가 필요함
- 권한/세션/피처 플래그에 따른 교차 도메인 상태 조합이 필요함

### 결과물

- 상위 수준 연동 다이어그램(모듈, 상태 소스, 캐시, 라우팅, 스토리지 포함)
- 상태/데이터 흐름도, 의존성 그래프(고수준)
- 연동 원칙/가이드 문서: Query 키 규칙, 무효화 매트릭스 원칙, DTO/adapter 원칙, 에러/UX 정책, 이벤트 규칙
- import/경계 수호 규칙 제안서(eslint/tsconfig 설정 가이드 초안)
- Phase 2/3 작업 항목 목록(도메인별 구현 TODO 개요)

## 1-3. 유틸리티 및 설정 인터페이스 정의

### Context 관리 전략

- **Phase**: Phase 1 (전체 설계)
- **Context 제한**: 전체 도메인 (context 길지만 설계 단계라 괜찮음)
- **필수 참조**: @memory.md, 1-1, 1-2 단계 결과물 (memory.md에서 자동 참조)
- **선택적 참조**: 기존 유틸리티 코드, 환경 설정 파일 (memory.md에서 자동 참조)

### AI에게 요청할 내용

```
전체 시스템을 바탕으로 유틸리티와 설정 인터페이스를 정의해주세요. 이 단계에서는 "요구사항 명세서로 정당화된 최소 유틸리티만" 제안하고, 구현 전에 사용자 승인(컨펌)을 반드시 받습니다.

[입력]
- 요구사항 명세서(필수)
- 도메인 모델 인터페이스(1-1 결과물)
- API 인터페이스(선택)
- UI 상태 인터페이스(선택)

[분석/정의]
1. 반드시 필요한 유틸리티만 식별(데이터 변환/검증/포맷팅/정렬·필터/에러 처리 중 실제 요구로 증명된 항목)
2. 각 유틸리티의 책임 경계와 시그니처 제안(예시 포함). 구현은 승인 후 진행
3. 외부 라이브러리(dayjs 등) 사용 필요 시 대안 비교(번들 크기, 트리 셰이킹, 라이선스, 로케일/타임존 요구 등)와 채택 근거 작성
4. 설정 타입 정의 원칙(환경별 설정, API 엔드포인트, 기능 플래그, UI/비즈니스 상수). 값은 Phase 2에서 구체화

[사전 승인 플로우]
- 유틸리티/라이브러리 제안서를 사용자에게 공유 → 사용자 컨펌 후에만 구현 시작
- 제안서 포함 항목: 목적, 시그니처 초안, 대안 비교, 영향도(성능/번들), 제거/대체 용이성

[명시적 제외]
- 요구사항에서 사용 근거가 없는 범용 유틸리티 추가 금지
- 중복 유틸리티 생성 금지(기존 공통 모듈 재사용 우선)
```

### 체크리스트

- [ ] 요구사항으로 정당화된 유틸리티만 제안됨(불필요 항목 없음)
- [ ] 각 유틸리티 책임 경계/시그니처가 제안됨(구현은 승인 후)
- [ ] 외부 라이브러리 사용 시 제안서에 대안 비교/근거가 포함됨
- [ ] 사용자 컨펌(승인) 절차가 문서화되고 실행됨(로그 남김)
- [ ] 환경별 설정/엔드포인트/플래그/상수 타입의 원칙이 합의됨
- [ ] 중복/과도한 유틸리티가 없음(재사용 우선)

### 결과물

- 유틸리티/라이브러리 제안서(승인 대상): 목적, 시그니처 초안, 대안 비교, 영향도
- 승인된 유틸리티 목록과 결정 로그(컨펌 결과)
- `shared/utils/` 폴더의 유틸리티 타입(시그니처 초안, 구현은 승인 후)
- `config/` 폴더의 설정 타입(원칙 수준 정의)

## 1-4. 도메인 이벤트 정의

### Context 관리 전략

- **Phase**: Phase 1 (전체 설계)
- **Context 제한**: 전체 도메인 (context 길지만 설계 단계라 괜찮음)
- **필수 참조**: @memory.md, 1-1, 1-2, 1-3 단계 결과물 (memory.md에서 자동 참조)
- **선택적 참조**: 비즈니스 프로세스 문서, 기존 이벤트 시스템 (memory.md에서 자동 참조)

### AI에게 요청할 내용

```
도메인 모델과 비즈니스 규칙을 바탕으로 도메인 이벤트를 정의해주세요:

[도메인 모델]
[비즈니스 규칙]

정의할 이벤트:
1. 엔티티 상태 변화 이벤트
2. 비즈니스 프로세스 이벤트
3. 외부 시스템 연동 이벤트
4. 사용자 액션 이벤트
5. 시스템 이벤트
6. 도메인 간 연동 이벤트

출력:
- 도메인 이벤트 목록
- 각 이벤트의 페이로드
- 이벤트 발생 조건
- 이벤트 처리 방법
- 도메인 간 이벤트 흐름
```

### 체크리스트

- [ ] 엔티티 상태 변화 이벤트가 정의됨
- [ ] 비즈니스 프로세스 이벤트가 정의됨
- [ ] 외부 시스템 연동 이벤트가 정의됨
- [ ] 사용자 액션 이벤트가 정의됨
- [ ] 시스템 이벤트가 정의됨
- [ ] 도메인 간 연동 이벤트가 정의됨
- [ ] 각 이벤트의 페이로드가 정의됨
- [ ] 이벤트 발생 조건이 명시됨
- [ ] 이벤트 처리 방법이 정의됨
- [ ] 이벤트 흐름도가 생성됨

### 결과물

- 도메인 이벤트 인터페이스 정의
- 이벤트 페이로드 타입 정의
- 이벤트 처리 규칙 문서
