# `/workflow-domain-definition` 커맨드

**사용 시점**: 도메인과 기능을 정의할 때

**기능**:

- 도메인 목록 및 경계 설정
- 페이지 구조 정의
- 기능 목록 도출
- (선택) 기능 의존성 분석

**권장사항**:

- 프로젝트 시작 시 가장 먼저 수행

**사용법**:

```
/workflow-domain-definition
```

---

## 목표

요구사항 명세를 분석하여 도메인 경계를 설정하고 페이지 수준 구조를 정의합니다.
선택적으로 기능 간 의존성을 분석하여 최적의 구현 순서를 도출합니다.

---

### 1단계: 요구사항 명세 확인

1. `docs/workflows/memory.md` 읽기 - 현재 진행 상황 파악
2. 요구사항 명세가 존재하는지 확인

**요구사항 명세가 없는 경우**:

- 📄 요구사항 명세 파일 첨부 요청 (`docs/requirements.md`)
- 📋 기존 시스템 문서 첨부 요청
- 💬 채팅으로 요구사항 직접 설명 요청

⚠️ 요구사항 제공 대기 후 진행 (진행 가능)

---

### 2단계: 요구사항 분석

**작업 내용**:

1. 요구사항 명세 분석
2. 핵심 기능 추출
3. 주요 액터(사용자 유형) 파악
4. 데이터 흐름 이해

---

### 3단계: 도메인 경계 파악

#### 도메인 경계 결정 가이드

**기본 원칙**:

1. **액터 중심**: 주요 액터가 명확하면 해당 도메인에 포함
2. **단순함 우선**: 복잡하지 않으면 분리하지 않음
3. **변경 격리**: 자주 변경되는 로직은 분리 고려
4. **응집도**: 관련 기능은 같은 도메인에 속함

#### 결정 기준 (순서대로 체크)

각 기능에 대해:

**1. 주요 액터가 명확한가?**

- YES → 해당 도메인에 포함 고려
- NO → 다음 단계

**2. 비즈니스 규칙이 복잡한가?**

- YES → 별도 도메인으로 분리 고려
- NO → 주 도메인에 포함

**3. 3개 이상의 도메인과 통합하는가?**

- YES → 다른 도메인으로 분리
- NO → 주 도메인에 포함

**4. 자주 변경되는가?** (월 단위 이상)

- YES → 별도 도메인으로 분리 고려
- NO → 주 도메인에 포함

#### 결정 예시

**예시 1 - 주 도메인에 포함**:

- 사례: 사용자 알림 설정
- 주요 액터: User ✓
- 복잡도: 낮음 (boolean flag)
- 관련 도메인: 1개
- **결론**: User 도메인에 포함

**예시 2 - 다른 도메인으로 분리**:

- 사례: 포인트/리워드 시스템
- 주요 액터: 불명확 (User, Order, Review 모두 관련)
- 복잡도: 높음 (적립/사용/만료 규칙)
- 관련 도메인: 4개 이상
- 변경 빈도: 높음
- **결론**: Reward 도메인으로 분리

---

### 4단계: 페이지 구조 정의

**작업 내용**:

1. 필요한 모든 페이지 파악
2. 각 페이지의 URL 경로 설계
3. 각 페이지의 관련 도메인 표시
4. 라우팅 구조 정의 (인증 필요 여부 등)

**주의사항**:

- ✅ 페이지 수준에서만 정의
- ✅ URL 구조 및 라우팅만 설계
- ❌ 페이지 내 세부 컴포넌트는 UI 설계 단계에서 정의

---

### 5단계: 기능 목록 도출

각 기능에 대해 다음 정보를 도출:

- **기능명**: 명확하고 구체적으로
- **주 도메인** (primaryDomain): 이 기능의 소유자
- **관련 도메인** (relatedDomains): 통합되는 도메인들
- **복잡도**: low / moderate / high
- **설명**: 간단한 설명

**논의가 필요한 경우**:

- 주 도메인이 불명확할 때
- 여러 도메인 배치 옵션이 존재할 때
- 다른 도메인으로 분리할지 모호할 때

이런 경우 `needsDiscussion: true`로 표시하고 배치 옵션 제안

---

### 6단계: 리소스 파악

주요 데이터 리소스만 파악:

- 예시: User, Product, Order, Review, Payment

**주의사항**:

- ✅ 리소스명만 나열
- ❌ API 엔드포인트는 구현 단계에서 정의

---

## 7단계: 기능 계획 (선택사항)

> 💡 **선택 단계**: 복잡한 프로젝트에서만 사용

> **간단한 프로젝트**: 이 섹션 건너뛸 수 있음

### 7-1. 기능 구현 순서가 필요한지 확인

#### 🔔 사용자 입력 필요

"기능 간 의존성을 분석하여 구현 순서를 정리하시겠습니까?"

- [ ] **예** - 의존성 분석 진행
- [ ] **아니오** - 개발자가 직접 순서 결정 (11단계로 이동)

**"아니오" 선택 시**: 11단계로 바로 이동

**"예" 선택 시**: 아래 진행

---

### 7-2. 의존성 그래프 생성

**AI 작업**: 기능 간 의존성 분석

**의존성 유형**:

- 직접 의존성: 기능 A가 명시적으로 기능 B 사용
- 데이터 의존성: 기능 A의 결과가 기능 B의 입력
- UI 의존성: 컴포넌트 A가 컴포넌트 B 포함

**예시**:

- F001 (상품 목록) → F002 (장바구니 추가)
- F002 (장바구니 추가) → F005 (주문하기)
- F003 (로그인) → F004 (마이페이지)

---

### 7-3. 위상 정렬

의존성 순서로 정렬:

1. 의존성 없는 기능부터
2. 의존성 해결 순서대로
3. 병렬 가능한 기능 그룹화

**예시 결과**:

- Group 1 (병렬 가능): F001, F003
- Group 2 (F001 완료 후): F002, F006
- Group 3 (F003 완료 후): F004
- Group 4 (F002 완료 후): F005

---

### 7-4. 순환 의존성 탐지 및 해결

**순환 의존성이 발견되면**:

#### 🔔 사용자 확인 필요

"⚠️ 순환 의존성이 감지되었습니다:"

**순환 경로 표시**:

```
F002 (장바구니 추가) → F005 (주문하기) → F002 (장바구니 수정)
```

**해결 옵션 제시**:

1. **공통 모듈 추출** (권장): 순환 의존 기능들의 공통 로직을 별도 모듈로 추출
2. **기능 병합**: 순환 의존 기능들을 하나의 큰 기능으로 병합
3. **의존성 제거**: 순환 의존 경로의 일부 기능을 제거/수정
4. **재설계 필요**: 도메인 경계를 다시 설정 필요

"어떤 옵션을 선택하시겠습니까?"

**사용자 선택 후**:

- 기능 목록 재정리
- 의존성 그래프 재생성
- 위상 정렬 재실행
- Memory 파일에 결정 사항 기록

---

### 7-5. 구현 순서 제안 및 승인

#### 🔔 사용자 검수 필요

"다음 순서로 기능을 구현할 계획입니다:"

**구현 순서**:

- Group 1 (병렬 가능): F001, F003
- Group 2 (F001 완료 후): F002, F006
- Group 3 (F003 완료 후): F004
- ...

**검수 권장사항**:

- 의존성이 올바르게 파악되었는가?
- 순서가 논리적인가?
- 병렬 가능 기능이 올바르게 그룹화되었는가?

**피드백**: (수정 필요 시 즉시 반영)

---

## 8단계: 전체 검수

### 검수 가이드 (AI용)

**기본 원칙**: 프로젝트 복잡도에 따라 유연하게 질문

**항상 물어볼 것**:

- 도메인 구조가 요구사항과 일치하는가?
- 기능 목록이 완전한가?

**조건부 질문**:

- 도메인이 많은 경우 (5개 이상): 도메인 경계가 명확한가?
- 페이지가 많은 경우 (10개 이상): 라우팅 구조가 직관적인가?
- 기능 계획을 수행한 경우: 의존성 분석이 적절한가?
- 기술 스택을 제안한 경우: 선택이 합리적인가?

**질문 스타일**:

- 개방형 질문 선호
- 문제 발견 시 구체적으로 지적
- 대안 제시

#### 🔔 사용자 검수

"도메인 정의 및 기능 계획이 완료되었습니다."

**결과 요약**:

**도메인 목록**:

- [Domain1]: [설명]
- [Domain2]: [설명]
- ...

**페이지 목록**:

- [URL]: [페이지명] - [관련 도메인]
- ...

**기능 목록**:

- [Feature1]: [주 도메인] - [복잡도]
- [Feature2]: [주 도메인] - [복잡도]
- ...

**기능 구현 순서** (계획한 경우):

- Group 1: [기능들]
- Group 2: [기능들]
- ...

**기술 스택** (제안한 경우):

- 상태 관리: [라이브러리]
- 라우팅: [라이브러리]
- ...

**검수 권장사항**:

- 도메인 구조가 적절한가?
- 페이지 목록이 완전한가?
- 기능 목록이 완전한가?
- (계획한 경우) 구현 순서가 적절한가?

**피드백**: (수정 필요 시 즉시 반영)

---

## 메모리 업데이트

**8단계 완료 시**: `memory.md`에서 해당 항목 체크

```markdown
- [x] 도메인 정의 (@domain-definition.md)
```

---

## 다음 단계

**도메인 정의 완료 후**:

- 권장: `/workflow-common-ui` (공통 UI 설계)
- 또는: `/workflow-ui [기능명]` (기능 UI 설계)
- 또는: `/workflow-implement [기능명]` (기능 구현)

---

## 결과물 파일 경로

- `docs/domain-definition.md` - 도메인 정의 및 구조
- `docs/page-structure.md` - 페이지 및 라우팅 구조
- `docs/feature-list.md` - 기능 목록 및 도메인 배치
- `docs/tech-stack.md` - 기술 스택 제안 (제안한 경우)
- `docs/implementation-order.md` - 기능 구현 순서 (계획한 경우)
